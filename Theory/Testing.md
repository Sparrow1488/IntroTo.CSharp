## Тестирование

### Типы тестирования

* Unit-testing (модульное тестирование) - тестирование отдельного участка кода (метода)
* Интеграционное тестирование - тестирование кода с внешними зависимостями (БД, Отправка писем и др)
* Системное тестирование - тестирование интегрированной системы

### Верификация и валидация

**Верификация** (оценка требований к системе) - это процесс оценки системы или ее компонентов с целью определения того, соответствуют результаты текущего этапа разработки условиям, сформированным в начале этого этапа.

**Валидация** (оценка пользователя) - это определения соответствия разрабатываемого ПО ожиданиям и потребностям пользователей, требованиям к системе. 

| Верификация                              | Валидация                            |
| ---------------------------------------- | ------------------------------------ |
| Делаем ли мы продукт правильно           | Делаем ли мы правильный продукт      |
| Реализована ли вся функциональность      | Правильно ли реализована эта функция |
| Производится разработчиками              | Производится тестировщиками          |
| Сравнение требований                     | Выполнение программы                 |
| Объективная оценка реализованных функций | Субъективная оценка приложения       |



### Свойства хорошего Unit-теста

* Автоматизированный и повторяемый
* Простой в реализации
* Многократное использование
* Все в команде имеют к нему доступ
* Запускается одной кнопкой без предварительных настроек
* Выполняется быстро

### Именование тестируемых методов и классов

UserManager - UserManager**Tests**
[Тестируемый метод] _ [Сценарий] _ [Результат]
**Примеры**: Sum_10plus20_30returned; IsPasswordValid_ArgumentNull_ArgNullException

### Какой код нужно тестировать

Не стоит тестировать:
1) Простой код без зависимостей
2) Сложный код с множеством зависимостей. Такой код можно протестировать <u>приемочными</u> тестами (разовыми) или после рефакторинга и разделение кода на небольшие тестируемые методы.

Стоит тестировать:
1. Сложный код без зависимостей - сложные алгоритмы, бизнес логика
2. Не очень сложный код с зависимостями.

### Шаблон написания тестов

**Подход ААА** - Arrange (инициализация переменных), Act (Выполнение кода метода), Assert (Проверка результатов).

### TDD

**Test Driven Development** - разработка через тестирование. Подход заключается в написании юнит-тестов перед написанием основного кода. То-есть мы пишем код под существующие тесты, а после рефакторим этот код и снова прогоняем через тесты.

Обычный подход:
Пишем класс **=>** пишем юнит-тест **=>** выполняем тесты **=>** исправляем ошибки

Подход TDD:
Пишем юнит-тест  **=>** пишем код **=>** запустить все тесты **=>** рефакторим **=>** написать юнит-тест

### Хорошее тестирование

При построении системы или библиотеки, необходимо учитывать то, что в будущем данную системы необходимо будет тестировать. Для того, чтобы система была хорошо тестируемой, все внутренние зависимости должны инициализироваться через конструктор класса.

```C#
// Хороший пример реализации, который можно легко протестировать
public class Controller {
    public Controller(ILogger<Controller> logger) {
        _logger = logger;
    }
    
    private readonly ILogger<Controller> _logger;
    
    public void Process() {
        _logger.LogInforamation("Process started...");
        // ....
    }
}
```

Например, в проекте используется логгер, который записывает все логи в базу данных. Класс с такой зависимостью может быть нелегко протестировать как минимум потому, что может не быть доступа к этой базе.  В примере выше мы без проблем можем передать в конструктор логгер, который не будет зависеть от базы данных, однако если бы данный класс был реализован как показано ниже, мы могли бы сказать Goodbye America

```C#
// Плохой пример реализации, который нельзя нормально протестировать
public class Controller {
    public Controller() { }
    
    private readonly ILogger _logger = new DbLogger();
    
    public void Process() {
        // Записываем лог только в базу данных
        _logger.LogInformation("Process started..."); 
    }
}
```

От такой прямой зависимости (инициализация через `new` в классе) необходимо избавляться, если мы хотим, чтобы класс был хорошо тестируемый.

